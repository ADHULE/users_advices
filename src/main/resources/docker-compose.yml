version: '3.8' # Version de la syntaxe Docker Compose

services: #  DÃ©finition des services Ã  dÃ©ployer

  db: #  Service de base de donnÃ©es MariaDB
    container_name: mariadb-11.3
    image: mariadb:11.3
    restart: always
    environment:
      MARIADB_ROOT_PASSWORD: example       #  Mot de passe du super utilisateur root
      MARIADB_DATABASE: useradvicesmariadb #  Nom de la base de donnÃ©es Ã  crÃ©er automatiquement
      MARIADB_USER: app_user               #  Nom dâ€™un utilisateur personnalisÃ©
      MARIADB_PASSWORD: app_pass           #  Mot de passe de lâ€™utilisateur personnalisÃ©
    ports:
      - "3308:3306" #  Redirige le port 3306 du conteneur vers le port 3308 de lâ€™hÃ´te
    volumes:
      - db_data:/var/lib/mysql # ğŸ’¾ Volume persistant pour stocker les donnÃ©es de la base
    networks:
      - backend #  ConnectÃ© au rÃ©seau interne "backend"

  adminer: #  Interface web simple pour gÃ©rer la base de donnÃ©es
    container_name: adminer-11.3
    image: adminer
    restart: always
    ports:
      - "9080:8080" #  Accessible via http://localhost:9080
    depends_on:
      - db # â³ Attend que le service "db" soit prÃªt
    networks:
      - backend

  phpmyadmin: # ğŸ› ï¸ Interface web avancÃ©e pour gÃ©rer MariaDB
    container_name: phpmyadmin
    image: phpmyadmin/phpmyadmin
    restart: always
    environment:
      PMA_HOST: db     # ğŸ”— HÃ´te de la base de donnÃ©es
      PMA_PORT: 3306   # ğŸ”Œ Port de connexion Ã  MariaDB
    ports:
      - "9090:80" # ğŸŒ Accessible via http://localhost:9090
    depends_on:
      - db
    networks:
      - backend

  smtp4dev: # ğŸ“¬ Service SMTP local pour tester lâ€™envoi/rÃ©ception dâ€™e-mails
    container_name: smtp4dev_container
    image: rnwood/smtp4dev:v3
    restart: always
    ports:
      - "5001:80"
      - "2526:25"
      - "1153:143"
      - "1120:110"

    volumes:
      - smtp4dev-data:/smtp4dev # ğŸ’¾ Volume pour stocker les messages et sessions
    environment:
      - ServerOptions__Urls=http://*:80
      - ServerOptions__HostName=smtp4dev
      - ServerOptions__LockSettings=true
      - ServerOptions__Mailboxes__0=Test=hello@world.com
      - ServerOptions__Database=database.db
      - ServerOptions__NumberOfMessagesToKeep=100
      - ServerOptions__NumberOfSessionsToKeep=50
      - ServerOptions__DisableIPv6=true
      - ServerOptions__TlsMode=None
    networks:
      - backend

# ğŸ“¦ DÃ©claration des volumes persistants
volumes:
  db_data:          # Volume pour MariaDB
  smtp4dev-data:    # Volume pour smtp4dev

# ğŸŒ DÃ©claration du rÃ©seau interne utilisÃ© par tous les services
networks:
  backend:
